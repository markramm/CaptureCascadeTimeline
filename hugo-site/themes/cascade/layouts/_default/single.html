{{ define "title" }}{{ .Title }} | {{ .Site.Title }}{{ end }}

{{ define "structured-data" }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "{{ .Title }}",
  "datePublished": "{{ .Params.date }}",
  "author": {
    "@type": "Organization",
    "name": "{{ .Site.Params.author }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ .Site.Title }}",
    "url": "{{ .Site.BaseURL }}"
  },
  "description": "{{ with .Params.summary }}{{ . }}{{ else }}{{ .Summary }}{{ end }}",
  {{ with .Params.tags }}"keywords": "{{ delimit . ", " }}",{{ end }}
  {{ with .Params.actors }}"mentions": [
    {{ range $index, $actor := . }}{{ if $index }},{{ end }}{
      "@type": "Person",
      "name": "{{ $actor }}"
    }{{ end }}
  ],{{ end }}
  "url": "{{ .Permalink }}"
}
</script>
{{ end }}

{{ define "main" }}
<article>
    <header>
        <h1>{{ .Title }}</h1>
        <div class="meta">
            <time datetime="{{ .Params.date }}">{{ .Params.date }}</time>
            {{ with .Params.importance }}
            | Importance: <strong>{{ . }}/10</strong>
            {{ end }}
            {{ with .Params.status }}
            | Status: <span style="text-transform: capitalize;">{{ . }}</span>
            {{ end }}
        </div>
    </header>

    <div class="content">
        {{ .Content }}
    </div>

    {{ with .Params.actors }}
    <div class="actors">
        <h3>Key Actors</h3>
        <div class="tags-list">
            {{ range . }}
            <a href="/actors/{{ urlize . }}" class="actor">{{ . }}</a>
            {{ end }}
        </div>
    </div>
    {{ end }}

    {{ with .Params.tags }}
    <div class="tags">
        <h3>Tags</h3>
        <div class="tags-list">
            {{ range . }}
            <a href="/tags/{{ urlize . }}" class="tag">{{ . }}</a>
            {{ end }}
        </div>
    </div>
    {{ end }}

    {{ with .Params.sources }}
    <div class="sources">
        <h4>Sources ({{ len . }})</h4>
        <ul>
            {{ range . }}
            <li>
                <a href="{{ .url }}" target="_blank" rel="noopener noreferrer">
                    {{ with .title }}{{ . }}{{ else }}{{ .url }}{{ end }}
                </a>
                {{ with .publisher }} - {{ . }}{{ end }}
                {{ with .date }} ({{ . }}){{ end }}
                {{ with .tier }} [Tier {{ . }}]{{ end }}
            </li>
            {{ end }}
        </ul>
    </div>
    {{ end }}

    <!-- Contribution Section -->
    <div class="contribute-section" style="margin-top: 40px; padding: 20px; background: #f9f9f9; border-radius: 8px; border-left: 4px solid #2563eb;">
        <h3 style="margin-top: 0;">Help Improve This Timeline</h3>
        <p style="margin-bottom: 15px;">Found an error or have additional information? You can help improve this event.</p>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            {{ $filePath := printf "timeline/data/events/%s.md" .File.BaseFileName }}
            <a href="https://github.com/markramm/CaptureCascadeTimeline/edit/main/{{ $filePath }}"
               target="_blank"
               rel="noopener noreferrer"
               style="display: inline-block; padding: 10px 20px; background: #2563eb; color: white; text-decoration: none; border-radius: 4px; font-weight: 500;">
                ✏️ Edit This Event
            </a>
            <a href="https://github.com/markramm/CaptureCascadeTimeline/issues/new?title=Suggest%20Event&labels=new-event&body=Please%20describe%20the%20event%20you%27d%20like%20to%20add%2C%20including%20date%2C%20title%2C%20summary%2C%20and%20sources."
               target="_blank"
               rel="noopener noreferrer"
               style="display: inline-block; padding: 10px 20px; background: #059669; color: white; text-decoration: none; border-radius: 4px; font-weight: 500;">
                ➕ Suggest New Event
            </a>
        </div>
        <p style="margin-top: 15px; margin-bottom: 0; font-size: 0.9rem; color: #666;">
            <strong>Edit:</strong> Opens GitHub editor to submit corrections or improvements via pull request.<br>
            <strong>Suggest:</strong> Opens a GitHub issue to propose a new event for the timeline.
        </p>
    </div>

    <nav class="event-nav" style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
        {{ with .PrevInSection }}
        <a href="{{ .Permalink }}" style="float: left;">← Previous Event</a>
        {{ end }}
        {{ with .NextInSection }}
        <a href="{{ .Permalink }}" style="float: right;">Next Event →</a>
        {{ end }}
        <div style="clear: both;"></div>
    </nav>
</article>
{{ end }}
